<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://kit.fontawesome.com/57b929fbcb.js" crossorigin="anonymous"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>  <!-- plotly -->
    <link rel="stylesheet" href="style.css">
    <title>Document</title>

    <!-- Icon git to link
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <i style="font-size:24px" class="fa">&#xf09b;</i>
    -->

    <!-- CSS File -->
    <link rel="stylesheet" href="style.css">

    <!-- BoxIcons v2.1.2 obs.: fazer nÃ£o dependerem de internet-->
    <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css">
</head>
<body class="light">
    <nav class="navbar">
        
    </nav>
    
    <div class="text">
        <h1>Temperature updated without refresh</h1>
        <div class="card">
            <h2><p>Temp:<span id="TempValue">0</span>&#8451;</p></h2><br>
        </div>

        <div id="graphTemp"></div>

        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi quas sed exercitationem ut repudiandae magnam tenetur doloremque ducimus modi sunt cupiditate eaque illo, mollitia maxime quaerat vel natus atque doloribus veniam reiciendis, id a ab! Ratione repellendus ut saepe fugit.</p>
    </div>
    
    <footer class="footer">
        
    </footer>

    <script src="/script.js"></script>

    <script>
        // ESP32 Update web page without refresh
        var cnt = 0;
        setInterval(function() {
            // Call a function repetatively with 2 Second interval
            getData("TempValue", "/temp/getTemp");
        }, 2000); //2000mSeconds update rate

        function getData(valueID, path) {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    document.getElementById(valueID).innerHTML = this.responseText;
                    value = parseFloat(this.responseText);
                    updateGraph(value);
                }
            };
            xhttp.open("GET", path, true);
            xhttp.send();
        }

        // Real time temperature graph

        Plotly.newPlot('graphTemp', [{
            y: [25],
            mode: 'lines+markers',
            marker: {color: 'gray', size:8},
            line: {width: 4},
            name: 'temp'
        }]);

        // Plotly.add_hline(y=28);
        
        function updateGraph(tempData) {
            console.log(tempData);
            Plotly.extendTraces('graphTemp', {
                y: [[tempData]]
            }, [0])

            cnt = cnt+1;
            if(cnt === 100) clearInterval(interval);
        }

    </script>

</body>
</html>